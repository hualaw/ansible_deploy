---
  - name: Install nginx
    apt: pkg=nginx

  - name: update nginx configuration
    copy: src=nginx.conf dest=/etc/nginx/nginx.conf
    
  - name: update nginx configuration(default)
    copy: src=nginx-default dest=/etc/nginx/sites-available/default
    
  - name: Install php-fpm
    apt: pkg={{item}}
    with_items:
      - php5-fpm
      - php5-dev
      - php5-cli
      - php-pear

  - name: copy php-fpm configurations
    copy: src=php5-fpm-pool.d-www.conf dest=/etc/php5/fpm/pool.d/www.conf
    
  - name: restart all services
    service: name={{item}} state=restarted
    with_items:
      - php5-fpm
      - nginx

  - name: copy monit configuration
    copy: src={{item}} dest=/etc/monit/conf.d/
    with_items:
      - check-nginx
      - check-phpfpm

  - name: reload monit resource
    service: name=monit state=reloaded

